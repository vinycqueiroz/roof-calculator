<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Roof Area Calculator</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="container">
    <h2>Roof Area Calculator</h2>
    <div id="structures">
      <div class="structure">
        <label>Roof Width (LF): 
	  <input type="number" inputmode="numeric" pattern="[0-9]*" class="width" />
	</label>
        <label>Roof Length (LF): 
	  <input type="number" inputmode="numeric" pattern="[0-9]*" class="length" />
	</label>
        <label>Pitch (X/12): 
	  <input type="number" inputmode="numeric" pattern="[0-9]*" class="pitch" value="6" min="0" />
	</label>
        <label>Waste Percentage (%): 
	  <input type="number" inputmode="numeric" pattern="[0-9]*" class="waste" value="15" />
	</label>
        <button onclick="calculateRoofArea(this)">Calculate</button>
        <h3 class="result"></h3>
      </div>
      <button id="addStructureBtn" onclick="addStructure()">Add Another Structure</button>
    </div>

    <div class="totals-box">
      <h3 id="totalArea">Total Square Footage: 0</h3>
      <h3 id="totalSquares">Total Squares: 0</h3>
    </div>

    <h2>Material Calculator</h2>
    <div class="structure">
      <label>Roof Squares: 
        <input type="number" inputmode="numeric" pattern="[0-9]*" id="mat-squares" />
      </label>
      <label>Eaves (LF): 
        <input type="number" inputmode="numeric" pattern="[0-9]*" id="mat-eaves" />
      </label>
      <label>Valleys (LF): 
        <input type="number" inputmode="numeric" pattern="[0-9]*" id="mat-valleys" />
      </label>
      <label>Hips (LF): 
        <input type="number" inputmode="numeric" pattern="[0-9]*" id="mat-hips" />
      </label>
      <label>Ridges (LF): 
        <input type="number" inputmode="numeric" pattern="[0-9]*" id="mat-ridges" />
      </label>
      <label>Rakes (LF): 
        <input type="number" inputmode="numeric" pattern="[0-9]*" id="mat-rakes" />
      </label>
      <label>Flashing (LF): 
        <input type="number" inputmode="numeric" pattern="[0-9]*" id="mat-flashing" />
      </label>
      <button onclick="generateMaterialList()">Generate Material List</button>
      <div id="materialList" class="result"></div>
    </div>
  </div>

  <script>
    const defaultUnits = {
      shinglesPerSquare: 3,
      hipRidgeLFPerBundle: 25,
      ridgeVentLFPerRoll: 20,
      starterLFPerBundle: 120,
      dripEdgeLFPerPiece: 10,
      stepFlashingLFPerBundle: 50,
      ventedSoffitLFPerPiece: 12,
      solidSoffitLFPerPiece: 12,
      friezeFasciaLFPerPiece: 18,
      iceWaterRollLength: 66,
      iceWaterSquaresPerRoll: 2,
      feltSquaresPerRoll: 10,
      plywoodSeamTapeLFPerRoll: 77,  // default roll length
    };

    function loadUnits() {
      const keys = Object.keys(defaultUnits);
      const units = {};
      keys.forEach(key => {
        const saved = localStorage.getItem(key);
        units[key] = saved !== null ? parseFloat(saved) : defaultUnits[key];
      });
      return units;
    }

    function saveUnit(key, value) {
      localStorage.setItem(key, value);
    }

    let totalSquareFootage = 0;
    let totalSquares = 0;

    function calculateRoofArea(button) {
      let structure = button.parentElement;
      let width = parseFloat(structure.querySelector(".width").value);
      let length = parseFloat(structure.querySelector(".length").value);
      let pitch = parseFloat(structure.querySelector(".pitch").value);
      let waste = parseFloat(structure.querySelector(".waste").value) / 100;

      if (!width || !length || !pitch || pitch < 1) {
        structure.querySelector(".result").innerText = "Please enter valid values. Pitch must be â‰¥ 1.";
        return;
      }

      let halfSpan = width / 2;
      let slopeFactor = Math.sqrt(pitch ** 2 + 12 ** 2) / 12;
      let rafterLength = halfSpan * slopeFactor;
      let totalArea = 2 * (rafterLength * length);
      let totalWithWaste = totalArea * (1 + waste);

      structure.querySelector(".result").innerText = `Structure Area: ${totalWithWaste.toFixed(2)}`;
      updateTotal();
    }

    function addStructure() {
      let newStructure = document.createElement("div");
      newStructure.classList.add("structure");
      newStructure.innerHTML = `
        <label>Roof Width (LF): <input type="number" class="width" /></label>
        <label>Roof Length (LF): <input type="number" class="length" /></label>
        <label>Pitch (X/12): <input type="number" class="pitch" value="6" min="1" /></label>
        <label>Waste Percentage (%): <input type="number" class="waste" value="15" /></label>
        <button onclick="calculateRoofArea(this)">Calculate</button>
        <h3 class="result"></h3>
      `;
      document.getElementById("structures").insertBefore(newStructure, document.getElementById("addStructureBtn"));
    }

    function updateTotal() {
      totalSquareFootage = 0;
      const structureResults = document.querySelectorAll("#structures .structure .result");
      structureResults.forEach(resultEl => {
        const text = resultEl.innerText;
        const match = text.match(/Structure Area: (\d+\.?\d*)/);
        if (match) {
          totalSquareFootage += parseFloat(match[1]);
        }
      });
      totalSquares = totalSquareFootage / 100;
      document.getElementById("totalArea").innerText = `Total Square Footage: ${totalSquareFootage.toFixed(2)}`;
      document.getElementById("totalSquares").innerText = `Total Squares: ${Math.ceil(totalSquares)}`; // round up squares
    }

    function generateMaterialList() {
      const units = loadUnits();

      const squares = parseFloat(document.getElementById("mat-squares").value) || 0;
      const eaves = parseFloat(document.getElementById("mat-eaves").value) || 0;
      const valleys = parseFloat(document.getElementById("mat-valleys").value) || 0;
      const hips = parseFloat(document.getElementById("mat-hips").value) || 0;
      const ridges = parseFloat(document.getElementById("mat-ridges").value) || 0;
      const rakes = parseFloat(document.getElementById("mat-rakes").value) || 0;
      const flashing = parseFloat(document.getElementById("mat-flashing").value) || 0;

      const combinedEavesRakes = eaves + rakes;
      const combinedHipsRidges = hips + ridges;

      const iceWaterLF = (eaves) * 2 + rakes + hips + ridges + valleys;
      const iceWaterRolls = Math.ceil(iceWaterLF / units.iceWaterRollLength);
      const iceWaterSquaresCovered = iceWaterRolls * units.iceWaterSquaresPerRoll;

      const remainingSquares = Math.max(0, squares - iceWaterSquaresCovered);
      const feltPaperRolls = Math.ceil(remainingSquares / units.feltSquaresPerRoll);

      // Plywood Seam Tape calculation: 48LF per square
      const plyTapeRollLength = units.plywoodSeamTapeLFPerRoll;
      const totalTapeLF = squares * 48;
      const plywoodSeamTapeRolls = Math.ceil(totalTapeLF / plyTapeRollLength);

      const shinglesQty = Math.ceil(squares * units.shinglesPerSquare);
      const hipRidgeQty = Math.ceil(combinedHipsRidges / units.hipRidgeLFPerBundle);
      const ridgeVentQty = Math.ceil(ridges / units.ridgeVentLFPerRoll);
      const starterQty = Math.ceil(eaves / units.starterLFPerBundle);
      const dripEdgeQty = Math.ceil(combinedEavesRakes / units.dripEdgeLFPerPiece);
      const flashingQty = Math.ceil(flashing / units.stepFlashingLFPerBundle);
      const ventedSoffitQty = Math.ceil(eaves / units.ventedSoffitLFPerPiece);
      const solidSoffitQty = Math.ceil(rakes / units.solidSoffitLFPerPiece);
      const friezeFasciaQty = Math.ceil(combinedEavesRakes / units.friezeFasciaLFPerPiece);

      const plywoodTapeOptions = [18, 36, 50, 55, 60, 75, 77, 100, 150, 180];

      const materialListHTML = `
        <div>
          <label>Shingles:
            <select id="shingleUnit" onchange="onUnitChange('shinglesPerSquare', this.value)">
              ${[1,2,3,4,5,6].map(v => `<option value="${v}" ${v == units.shinglesPerSquare ? 'selected' : ''}>${v} BD/SQ</option>`).join('')}
            </select>
            <span>${shinglesQty} Bundles</span>
          </label><br>

          <label>Hip & Ridge Caps:
            <select id="hipRidgeUnit" onchange="onUnitChange('hipRidgeLFPerBundle', this.value)">
              ${[18,25,30].map(v => `<option value="${v}" ${v == units.hipRidgeLFPerBundle ? 'selected' : ''}>${v} LF/BD</option>`).join('')}
            </select>
            <span>${hipRidgeQty} Bundles</span>
          </label><br>

          <label>Ridge Vents:
            <select id="ridgeVentUnit" onchange="onUnitChange('ridgeVentLFPerRoll', this.value)">
              ${[4,20,28,50].map(v => `<option value="${v}" ${v == units.ridgeVentLFPerRoll ? 'selected' : ''}>${v} LF/RL</option>`).join('')}
            </select>
            <span>${ridgeVentQty} Rolls</span>
          </label><br>

          <label>Ice & Water (<span>2SQ/RL</span>):
            <span>${iceWaterRolls} Rolls</span>
          </label><br>

          <label>Felt Paper (<span>10SQ/RL</span>):
            <span>${feltPaperRolls} Rolls</span>
          </label><br>

          <label>Plywood Seam Tape:
            <select id="plywoodSeamTapeUnit" onchange="onUnitChange('plywoodSeamTapeLFPerRoll', this.value)">
              ${plywoodTapeOptions.map(v => `<option value="${v}" ${v == units.plywoodSeamTapeLFPerRoll ? 'selected' : ''}>${v} LF/Roll</option>`).join('')}
            </select>
            <span>${plywoodSeamTapeRolls} Rolls</span>
          </label><br>

          <label>Starter Strip:
            <select id="starterUnit" onchange="onUnitChange('starterLFPerBundle', this.value)">
              ${[102,116,120].map(v => `<option value="${v}" ${v == units.starterLFPerBundle ? 'selected' : ''}>${v} LF/BD</option>`).join('')}
            </select>
            <span>${starterQty} Bundles</span>
          </label><br>

          <label>Drip Edge (<span>10LF/PC</span>):
            <span>${dripEdgeQty} Pieces</span>
          </label><br>

          <label>Step Flashing:
            <select id="stepFlashingUnit" onchange="onUnitChange('stepFlashingLFPerBundle', this.value)">
              ${[41,48,50].map(v => `<option value="${v}" ${v == units.stepFlashingLFPerBundle ? 'selected' : ''}>${v} LF/BD</option>`).join('')}
            </select>
            <span>${flashingQty} Bundles</span>
          </label><br>

          <label>Vented Soffits:
            <select id="ventedSoffitUnit" onchange="onUnitChange('ventedSoffitLFPerPiece', this.value)">
              ${[12,10].map(v => `<option value="${v}" ${v == units.ventedSoffitLFPerPiece ? 'selected' : ''}>${v} LF/PC</option>`).join('')}
            </select>
            <span>${ventedSoffitQty} Pieces</span>
          </label><br>

          <label>Solid Soffits:
            <select id="solidSoffitUnit" onchange="onUnitChange('solidSoffitLFPerPiece', this.value)">
              ${[12,10].map(v => `<option value="${v}" ${v == units.solidSoffitLFPerPiece ? 'selected' : ''}>${v} LF/PC</option>`).join('')}
            </select>
            <span>${solidSoffitQty} Pieces</span>
          </label><br>

          <label>Frieze / Fascia:
            <select id="friezeFasciaUnit" onchange="onUnitChange('friezeFasciaLFPerPiece', this.value)">
              ${[20,18,16,12,8].map(v => `<option value="${v}" ${v == units.friezeFasciaLFPerPiece ? 'selected' : ''}>${v} LF/PC</option>`).join('')}
            </select>
            <span>${friezeFasciaQty} Pieces</span>
          </label>
        </div>
      `;

      document.getElementById("materialList").innerHTML = materialListHTML;
    }

    function onUnitChange(unitKey, newValue) {
      let val = parseFloat(newValue);
      if (!isNaN(val)) {
        saveUnit(unitKey, val);
        generateMaterialList();
      }
    }
  </script>
</body>
</html>
